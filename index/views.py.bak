# coding=utf8
from django.shortcuts import render,get_object_or_404

from django.contrib.auth.decorators import login_required
from django.contrib.auth.models import User

@login_required
def index(request):
    #首页公共部分参数：项目数，发布次数，用户总数等 
    from release.models import projectinfo
    from release.models import release
    from django.contrib.auth.models import User

    release_all_counts = release.objects.all().count()
    user_counts = User.objects.all().count()
    project_counts = projectinfo.objects.filter(isinit=1).count() 

    request.session['release_all_counts'] = release_all_counts
    request.session['user_counts'] = user_counts
    request.session['project_counts'] = project_counts

    #
    request.session['domain'] = request.META['HTTP_HOST']
    request.session['your_ip'] = request.META['REMOTE_ADDR']
    
    import django
    request.session['django_version'] = django.get_version()

    from django.db import connection
    cursor = connection.cursor()
    cursor.execute("SELECT VERSION()")
    for i in cursor.fetchone():
        request.session['mysql_version'] = i

    return render(request,'index/index.html')

